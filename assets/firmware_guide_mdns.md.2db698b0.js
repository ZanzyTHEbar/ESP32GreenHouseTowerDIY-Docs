import{_ as e,o,c as n,h as a}from"./app.a9fb2c4c.js";const m=JSON.parse('{"title":"MDNS # Firmware Guide","description":"","frontmatter":{},"headers":[{"level":2,"title":"What is it?","slug":"what-is-it","link":"#what-is-it","children":[]},{"level":2,"title":"How to use it","slug":"how-to-use-it","link":"#how-to-use-it","children":[{"level":3,"title":"Enable mDNS","slug":"enable-mdns","link":"#enable-mdns","children":[]},{"level":3,"title":"Connect to the device","slug":"connect-to-the-device","link":"#connect-to-the-device","children":[]}]},{"level":2,"title":"Prerequisites Bonjour","slug":"prerequisites-bonjour","link":"#prerequisites-bonjour","children":[]},{"level":2,"title":"MQTT Broker Auto Discovery","slug":"mqtt-broker-auto-discovery","link":"#mqtt-broker-auto-discovery","children":[{"level":3,"title":"MQTT Broker Configuration and Connection","slug":"mqtt-broker-configuration-and-connection","link":"#mqtt-broker-configuration-and-connection","children":[]}]},{"level":2,"title":"Troubleshooting","slug":"troubleshooting","link":"#troubleshooting","children":[{"level":3,"title":"Can not connect to the device","slug":"can-not-connect-to-the-device","link":"#can-not-connect-to-the-device","children":[]}]}],"relativePath":"firmware_guide/mdns.md","lastUpdated":1676225161000}'),t={name:"firmware_guide/mdns.md"},s=a(`<h1 class="text-[var(--font-accent)]" id="mdns-firmware-guide" tabindex="-1">MDNS # Firmware Guide <a class="header-anchor" href="#mdns-firmware-guide" aria-hidden="true">#</a></h1><h2 id="what-is-it" tabindex="-1">What is it? <a class="header-anchor" href="#what-is-it" aria-hidden="true">#</a></h2><p><code>mDNS</code> is a protocol that allows you to connect to a device using a name instead of an IP address. This is useful if you do not know the IP address of the device, or if you do not want to keep track of the IP address of the device. This is also useful if you are using a device that does not have a static IP address.</p><p>In the <code>mDNS</code> protocol the IP address of the device can change, but the name of the device will always be the same. This means that you can connect to the device using the name of the device, even if the IP address of the device changes.</p><h2 id="how-to-use-it" tabindex="-1">How to use it <a class="header-anchor" href="#how-to-use-it" aria-hidden="true">#</a></h2><h3 id="enable-mdns" tabindex="-1">Enable mDNS <a class="header-anchor" href="#enable-mdns" aria-hidden="true">#</a></h3><p>The <code>mDNS</code> feature is enabled by default on the new firmware, and can not be disabled.</p><p>To use it, all you need to do is set the name of the device in the firmware config file.</p><div class="info custom-block"><p class="custom-block-title">Config file</p><p>If you are building from source, you can find the config file in the <code>ini</code> folder.</p><p>This setting can be located under the <code>[wifi]</code> section of the <code>ini/user_config.ini</code> file.</p><p>If you are using the pre-built firmware, you can edit this setting in <a href="/ESP32GreenHouseTowerDIY-Docs/firmware_guide/configure_firmware">Configure Firmware</a>.</p></div><div class="language-ini line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F07178;">mdnsname</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">greenhousetower</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># do not add .local</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>By default, the name of the device is <code>greenhousetower</code>, however you can change it to whatever you want.</p><div class="warning custom-block"><p class="custom-block-title">Change the name</p><p>If you have more than one ESP32 device using this firmware, you need to make sure that the name of the device is different for each device. If you do not change the name of the device, you will not be able to connect to both devices at the same time, as they will conflict with each other.</p></div><h3 id="connect-to-the-device" tabindex="-1">Connect to the device <a class="header-anchor" href="#connect-to-the-device" aria-hidden="true">#</a></h3><p>To connect to the device, you need to use the name of the device followed by <code>.local</code>. For example, if the name of the device is <code>esp32</code>, you can connect to the device using <code>http://esp32.local</code>.</p><h2 id="prerequisites-bonjour" tabindex="-1">Prerequisites <code>Bonjour</code> <a class="header-anchor" href="#prerequisites-bonjour" aria-hidden="true">#</a></h2><p><code>Bonjour</code> is required to use the <code>mDNS</code> protocol <em>for windows and mac only</em>. If you are using Windows, you can download Bonjour from <a href="https://support.apple.com/kb/DL999?locale=en_US" target="_blank" rel="noreferrer">here</a>. If you are using macOS, Bonjour is already installed.</p><p>You can also get the fully tested Bonjour package from us <a href="https://github.com/RedHawk989/EyeTrackVR/tree/GUI/GUI/assets/3rdParty" target="_blank" rel="noreferrer">here</a> (for Windows only).</p><h2 id="mqtt-broker-auto-discovery" tabindex="-1">MQTT Broker Auto Discovery <a class="header-anchor" href="#mqtt-broker-auto-discovery" aria-hidden="true">#</a></h2><p>The firmware implements a convienent <code>Auto Discovery</code> feature. This means that you can connect to the MQTT Broker automagically without having to manually configure the MQTT Broker&#39;s IP address.</p><hr><h3 id="mqtt-broker-configuration-and-connection" tabindex="-1">MQTT Broker Configuration and Connection <a class="header-anchor" href="#mqtt-broker-configuration-and-connection" aria-hidden="true">#</a></h3><p>The MQTT Broker is a free self-hosted service that allows you to publish and subscribe to MQTT messages. To automate the connection process, this project offers Multi-Cast DNS (mDNS/Zeroconf) to find the broker. For this to work, you must have a broker on your local network, and you must have only 1 MQTT broker within the range of the client, otherwise the client will simply connect to the first broker it finds.</p><p>Using a Zeroconf approach we can avoid having to hard code the broker&#39;s IP address or hostname into the client device&#39;s firmware. Instead we can use DNS-SD and Avahi/Bonjour to discover the server hosting the MQTT broker.</p><p>To enable MQTT discovery on the broker, simply install avahi-daemon (assuming the broker is running <code>Debian</code> or some form of Linux).</p><h4 id="option-one" tabindex="-1">Option One <a class="header-anchor" href="#option-one" aria-hidden="true">#</a></h4><p>If you are using Home Assistant, you can use the MQTT Discovery feature within the firmware, and the MQTT broker will be discovered automatically. Nothing is needed from you for this to work. Simply turn on the ESP32 and be connected to the same network as the MQTT broker.</p><p>You can refer to the <a href="https://www.home-assistant.io/integrations/zeroconf/" target="_blank" rel="noreferrer">ZeroConf Documentation here</a> and <a href="https://developers.home-assistant.io/docs/creating_integration_manifest/#zeroconf" target="_blank" rel="noreferrer">here</a> for more information and troubleshooting.</p><p>If for some reason you are unable to use the MQTT Discovery feature, you can still use the mDNS feature to discover the broker, see Option Two below.</p><h4 id="option-two" tabindex="-1">Option Two <a class="header-anchor" href="#option-two" aria-hidden="true">#</a></h4><p>You will need to install the <a href="https://avahi.org/" target="_blank" rel="noreferrer">avahi</a> package. For Debian-based systems, use the following command:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apt-get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">avahi-daemon</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>For this to work, the MQTT service needs to be advertised. On a Linux host system, Avahi can be configured to do this by including the following in <code>/etc/avahi/services/mqtt.service</code>:</p><div class="language-xml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F78C6C;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#A6ACCD;">service-group</span><span style="color:#89DDFF;"> SYSTEM &quot;avahi-service.dtd&quot;&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">service-group</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">name</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">replace-wildcards</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">yes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">MQTT on %h</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">service</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">_mqtt._tcp</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">port</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">1883</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">port</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">service</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">service-group</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>This will advertise the MQTT service on port 1883. If you are using a different port, you will need to change it in the above file.</p><p>Now you are ready to connect to the MQTT broker, automagically.</p><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-hidden="true">#</a></h2><h3 id="can-not-connect-to-the-device" tabindex="-1">Can not connect to the device <a class="header-anchor" href="#can-not-connect-to-the-device" aria-hidden="true">#</a></h3><p>If you can not connect to the device, make sure that the name of the device is correct. If the name of the device is correct, make sure that the device is connected to the network.</p><p>If the device is connected to the network, try to restart the device. If the device is still not connected, try to restart the router.</p>`,39),r=[s];function i(l,c,p,d,h,u){return o(),n("div",null,r)}const y=e(t,[["render",i]]);export{m as __pageData,y as default};
